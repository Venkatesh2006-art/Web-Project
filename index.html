<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart City Citizen Portal – Interactive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      /* Neutral light theme */
      --bg: #f3f4f6;
      --bg-soft: #ffffff;
      --bg-panel: #ffffff;
      --glass-border: rgba(15, 23, 42, 0.06);

      /* Brand colors */
      --accent: #2563eb;      /* primary blue */
      --accent-2: #0ea5e9;    /* cyan accent */
      --accent-3: #f97316;    /* secondary accent */

      /* Text */
      --text: #111827;
      --muted: #6b7280;

      /* Status */
      --danger: #ef4444;
      --warning: #f59e0b;

      --radius: 14px;
      --shadow-soft: 0 10px 26px rgba(15,23,42,0.06);
    }

    body.light {
      --bg: #f3f4f6;
      --bg-soft: #ffffff;
      --bg-panel: #ffffff;
      --glass-border: rgba(15, 23, 42, 0.06);
      --text: #111827;
      --muted: #6b7280;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      color: var(--text);
      background: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 60%);
      overflow-x: hidden;
    }

    .bg-orbit {
      position: fixed;
      inset: -20%;
      pointer-events: none;
      z-index: -1;
      background:
        radial-gradient(circle at 0% 0%, rgba(37,99,235,0.08) 0, transparent 50%),
        radial-gradient(circle at 100% 0%, rgba(14,165,233,0.08) 0, transparent 55%);
      filter: blur(4px);
      animation: bgFloat 18s ease-in-out infinite alternate;
      opacity: 0.9;
    }
    @keyframes bgFloat {
      from { transform: translate3d(-10px, 0, 0) scale(1); }
      to   { transform: translate3d(10px, -12px, 0) scale(1.03); }
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.85rem 1.7rem;
      backdrop-filter: blur(18px);
      background: linear-gradient(90deg, rgba(255,255,255,0.96), rgba(249,250,251,0.96));
      border-bottom: 1px solid rgba(15, 23, 42, 0.06);
      position: sticky;
      top: 0;
      z-index: 30;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
    }
    .logo {
      font-weight: 700;
      font-size: 1.25rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #1f2933;
    }
    .logo span {
      padding: 0.16rem 0.6rem;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #ffffff;
      font-size: 0.8rem;
    }
    .topbar-right {
      display: flex;
      align-items: center;
      gap: 0.9rem;
    }
    #dateTime {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .navbar {
      padding: 0.55rem 1.7rem 0.85rem;
      position: sticky;
      top: 56px;
      z-index: 20;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(249,250,251,0.96), transparent);
      border-bottom: 1px solid rgba(15, 23, 42, 0.04);
    }
    .navbar ul {
      display: flex;
      list-style: none;
      gap: 0.6rem;
      overflow-x: auto;
      padding-bottom: 0.15rem;
    }
    .nav-item {
      padding: 0.4rem 0.95rem;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.9rem;
      color: var(--muted);
      white-space: nowrap;
      border: 1px solid transparent;
      background: #ffffff;
      box-shadow: 0 1px 2px rgba(15,23,42,0.04);
      transition: background 0.2s, color 0.2s, transform 0.12s, box-shadow 0.12s, border-color 0.2s;
    }
    .nav-item:hover {
      color: #111827;
      background: #eef2ff;
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(15,23,42,0.08);
    }
    .nav-item.active {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #ffffff;
      font-weight: 600;
      border-color: transparent;
      box-shadow: 0 6px 16px rgba(37,99,235,0.25);
    }

    main {
      padding: 1.5rem 1.7rem 1.7rem;
    }

    .content { min-width: 0; }

    .page { display: none; animation: fadeIn 0.28s ease-out; }
    .page.visible { display: block; }
    .page.animate-in { animation: slideFadeIn 0.3s ease-out; }

    h1 {
      font-size: 1.6rem;
      margin-bottom: 0.6rem;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: #111827;
    }
    .subtitle {
      font-size: 0.95rem;
      color: var(--muted);
      margin-bottom: 1.2rem;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    /* Updated panels and metric cards */
    .card,
    .panel {
      border-radius: 14px;
      padding: 1.1rem 1.1rem 1rem;
      background: #ffffff;
      border: 1px solid rgba(148,163,184,0.28);
      box-shadow: 0 10px 26px rgba(15,23,42,0.06);
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.16s ease-out, border-color 0.16s, transform 0.1s;
    }
    .card:hover,
    .panel:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(15,23,42,0.10);
      border-color: rgba(37,99,235,0.25);
    }

    .panel h2 {
      font-size: 1.05rem;
      margin-bottom: 0.6rem;
      color: #0f172a;
    }

    .cards .card {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .metric-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: var(--muted);
      margin-bottom: 0.3rem;
    }
    .metric-value {
      font-size: 1.9rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: baseline;
      gap: 0.25rem;
      color: #111827;
    }
    .metric-unit { font-size: 0.8rem; color: var(--muted); }
    .metric-trend { font-size: 0.78rem; color: #16a34a; }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.16rem 0.55rem;
      border-radius: 999px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .tag.good { background: #dcfce7; color: #166534; }
    .tag.warning { background: #fef9c3; color: #854d0e; }
    .tag.danger { background: #fee2e2; color: #b91c1c; }
    .tag.info { background: #e0f2fe; color: #075985; }

    .chip {
      border-radius: 999px;
      padding: 0.16rem 0.48rem;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      border: 1px solid rgba(148,163,184,0.3);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 0.24rem;
      margin-bottom: 0.45rem;
    }
    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.75);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 0.45rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.1s, background 0.2s, color 0.2s;
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }
    .btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at var(--ripple-x,50%) var(--ripple-y,50%), rgba(255,255,255,0.35) 0, transparent 55%);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .btn.rippling::after { opacity: 1; }
    .btn.primary {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #ffffff;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(37,99,235,0.30);
    }
    .btn.secondary {
      background: #ffffff;
      color: #111827;
      border: 1px solid rgba(15,23,42,0.12);
    }
    .btn.ghost {
      background: transparent;
      color: var(--muted);
      border: 1px dashed rgba(148,163,184,0.5);
    }
    .btn.small { padding: 0.3rem 0.8rem; font-size: 0.8rem; }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(15,23,42,0.10);
    }
    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
    }

    .list { list-style: none; }
    .list li {
      padding: 0.35rem 0;
      font-size: 0.9rem;
      border-bottom: 1px dashed rgba(148,163,184,0.25);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .list li:last-child { border-bottom: none; }
    .list.small li { font-size: 0.85rem; }

    .status-pill {
      padding: 0.1rem 0.55rem;
      border-radius: 999px;
      font-size: 0.75rem;
    }
    .status-open {
      background: #fee2e2;
      border: 1px solid #ef4444;
      color: #b91c1c;
    }
    .status-submitted {
      background: #e0f2fe;
      border: 1px solid #0ea5e9;
      color: #0369a1;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    .table th,
    .table td {
      padding: 0.5rem 0.6rem;
      border-bottom: 1px solid rgba(148,163,184,0.25);
      text-align: left;
    }
    .table th {
      background: #f3f4f6;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 5;
    }
    .table tr:nth-child(even) td {
      background: #f9fafb;
    }

    .form label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 0.6rem;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="password"],
    select,
    textarea {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.45);
      margin-top: 0.2rem;
      background: #ffffff;
      color: var(--text);
      font-size: 0.9rem;
    }
    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid rgba(37,99,235,0.6);
      border-color: transparent;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.1);
    }

    .service-card p {
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 0.7rem;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 60;
      backdrop-filter: blur(16px);
    }
    .modal.show { display: flex; }
    .modal-content {
      background: #ffffff;
      border-radius: 22px;
      padding: 1.4rem 1.2rem 1.2rem;
      width: min(500px, 94vw);
      box-shadow: 0 24px 60px rgba(15,23,42,0.18);
      border: 1px solid rgba(148,163,184,0.25);
      position: relative;
      overflow: hidden;
    }
    .modal-close {
      position: absolute;
      right: 0.75rem;
      top: 0.65rem;
      cursor: pointer;
      font-size: 1.3rem;
      color: var(--muted);
    }
    .success-msg {
      margin-top: 0.8rem;
      font-size: 0.9rem;
      color: #16a34a;
    }

    .footer {
      margin-top: 1rem;
      padding: 0.8rem 1.7rem 1.3rem;
      font-size: 0.8rem;
      color: var(--muted);
      text-align: center;
      border-top: 1px solid rgba(15,23,42,0.06);
      background: #f9fafb;
    }

    .muted { color: var(--muted); font-size: 0.85rem; }
    .hidden { display: none !important; }

    .auth-tabs {
      display: inline-flex;
      gap: 0.5rem;
      margin: 0.4rem 0 0.8rem;
      padding: 0.2rem;
      border-radius: 999px;
      background: #f3f4f6;
      border: 1px solid rgba(148,163,184,0.6);
    }

    .form.inline {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-end;
      gap: 0.5rem;
      margin-bottom: 0.4rem;
    }
    .form.inline label { margin-bottom: 0; min-width: 120px; }

    .link-btn {
      background: none;
      border: none;
      padding: 0;
      color: var(--accent-2);
      cursor: pointer;
      font-size: 0.85rem;
    }
    .link-btn:hover { text-decoration: underline; }

    /* Updated bar chart styling */
    .bar-chart {
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
      margin-top: 0.75rem;
    }

    .bar-row {
      display: grid;
      grid-template-columns: 90px minmax(0, 1fr) 48px;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .bar-label {
      font-weight: 500;
      color: #4b5563;
    }

    .bar-track {
      position: relative;
      height: 8px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .bar-track::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 0 1px rgba(148,163,184,0.35);
    }

    .bar-fill {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, #22c55e, #16a3eb);
      width: 0%;
      transition: width 0.6s ease-out;
    }

    .bar-val {
      text-align: right;
      font-variant-numeric: tabular-nums;
      color: #111827;
      font-weight: 500;
    }

    .confetti-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 80;
    }
    .confetti-piece {
      position: absolute;
      width: 6px;
      height: 10px;
      background: #38bdf8;
      opacity: 0.9;
      top: -10px;
      border-radius: 2px;
      animation: confettiFall 1.4s linear forwards;
    }
    @keyframes confettiFall {
      to {
        transform: translate3d(var(--dx,0px), 110vh, 0) rotate(340deg);
        opacity: 0;
      }
    }

    body.light .modal-content input,
    body.light .modal-content textarea,
    body.light .modal-content select {
      background: #ffffff;
      color: #111827;
    }

    @media (max-width: 640px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.4rem;
      }
      .navbar {
        top: auto;
        position: static;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .city-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .city-card {
      width: min(420px, 92vw);
      padding: 1.6rem 1.4rem 1.4rem;
      border-radius: 24px;
      background: #ffffff;
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 24px 60px rgba(15,23,42,0.22);
      text-align: center;
    }
    .city-card h1 {
      font-size: 1.5rem;
      margin-bottom: 0.3rem;
      text-transform: none;
      letter-spacing: 0.04em;
    }
    .city-card p {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 1rem;
    }
    .city-select-row {
      margin: 0.6rem 0 0.9rem;
      text-align: left;
    }
    .city-select-row label {
      font-size: 0.85rem;
      color: var(--muted);
    }
    .city-select-row select {
      margin-top: 0.35rem;
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: #ffffff;
      color: var(--text);
    }
    .city-chip-row {
      margin-top: 0.7rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      justify-content: center;
    }
    .city-chip {
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      border: 1px dashed rgba(148,163,184,0.45);
      font-size: 0.8rem;
      color: var(--muted);
      cursor: pointer;
    }
    .city-chip:hover {
      border-style: solid;
      color: var(--text);
    }
    .city-selected-label {
      margin-top: 0.4rem;
      font-size: 0.85rem;
      color: #16a34a;
    }

    .bottom-bar {
      margin-top: 1.5rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem;
    }
  </style>
</head>
<body>
  <div class="bg-orbit"></div>

  <div id="cityOverlay" class="city-overlay">
    <div class="city-card tilt-card">
      <h1>Choose your Smart City</h1>
      <p>Select a city to personalize the dashboard and services for local conditions.</p>
      <div class="city-select-row">
        <label for="citySelect">City</label>
        <select id="citySelect">
          <option value="">Select city</option>
          <option value="Mumbai">Mumbai</option>
          <option value="Delhi">Delhi</option>
          <option value="Bengaluru">Bengaluru</option>
          <option value="Hyderabad">Hyderabad</option>
          <option value="Chennai">Chennai</option>
          <option value="Vijayawada">Vijayawada</option>
          <option value="Guntur">Guntur</option>
          <option value="Vizag">Vizag</option>
          <option value="Tirupati">Tirupati</option>
          <option value="Vellore">Vellore</option>
        </select>
      </div>
      <div class="city-chip-row">
        <span class="city-chip" data-city="Vijayawada">Vijayawada</span>
        <span class="city-chip" data-city="Vizag">Vizag</span>
        <span class="city-chip" data-city="Guntur">Guntur</span>
        <span class="city-chip" data-city="Hyderabad">Hyderabad</span>
      </div>
      <p id="selectedCityLabel" class="city-selected-label hidden"></p>
      <div style="margin-top:1rem; display:flex; gap:0.6rem; justify-content:center;">
        <button id="cityConfirmBtn" class="btn primary">Enter Portal</button>
        <button id="cityResetBtn" class="btn ghost small">Reset selection</button>
      </div>
    </div>
  </div>

  <header class="topbar">
    <div class="logo">SMART CITY<span id="cityNameBadge">PORTAL</span></div>
    <div class="topbar-right">
      <span id="dateTime"></span>
      <div id="userArea">
        <span id="welcomeUser" class="muted"></span>
        <button id="loginBtn" class="btn small secondary">Login</button>
        <button id="logoutBtn" class="btn small ghost hidden">Logout</button>
      </div>
      <button id="themeToggle" class="btn small ghost">Dark</button>
    </div>
  </header>

  <nav class="navbar">
    <ul>
      <li class="nav-item active" data-target="dashboard">Dashboard</li>
      <li class="nav-item" data-target="services">Services</li>
      <li class="nav-item" data-target="transport">Transport</li>
      <li class="nav-item" data-target="complaints">Complaints</li>
      <li class="nav-item" data-target="profile">My Profile</li>
      <li class="nav-item" data-target="about">About City</li>
    </ul>
  </nav>

  <main>
    <section class="content">
      <section id="dashboard" class="page visible">
        <h1 id="dashTitle">City Operations</h1>
        <p class="subtitle" id="dashSubtitle">Live snapshot of environment, mobility, and utilities.</p>

        <div class="cards">
          <div class="card tilt-card">
            <div class="metric-label">Air Quality Index</div>
            <div class="metric-value">
              <span id="aqiValue">54</span>
              <span class="metric-unit">AQI</span>
            </div>
            <span class="tag good" id="aqiTag">Good</span>
            <div class="metric-trend" id="aqiTrend">+2 vs yesterday</div>
          </div>
          <div class="card tilt-card">
            <div class="metric-label">Traffic Congestion</div>
            <div class="metric-value">
              <span id="trafficValue">Moderate</span>
            </div>
            <span class="tag warning">Live</span>
            <div class="metric-trend" id="trafficTrend">Most congestion at Central Square</div>
          </div>
          <div class="card tilt-card">
            <div class="metric-label">Energy Usage</div>
            <div class="metric-value">
              <span id="energyValue">128.4</span>
              <span class="metric-unit">MW</span>
            </div>
            <span class="tag info">Today</span>
            <div class="metric-trend" id="energyTrend">Peak at 7:30 PM</div>
          </div>
          <div class="card tilt-card">
            <div class="metric-label">Water Capacity</div>
            <div class="metric-value">
              <span id="waterValue">76</span>
              <span class="metric-unit">%</span>
            </div>
            <span class="tag info">Reservoirs</span>
            <div class="metric-trend" id="waterTrend">Stable supply</div>
          </div>
        </div>

        <div class="grid-2">
          <div class="panel tilt-card">
            <div class="chip"><span class="chip-dot"></span> City alerts</div>
            <h2>Live Alerts & Notifications</h2>
            <ul id="alertsList" class="list"></ul>
          </div>

          <div class="panel tilt-card">
            <div class="chip"><span class="chip-dot"></span> City sensors</div>
            <h2>Smart Infrastructure Snapshot</h2>
            <ul class="list">
              <li><span>Smart streetlights online</span><strong>1,240</strong></li>
              <li><span>Parking sensors active</span><strong>865</strong></li>
              <li><span>Waste bins with IoT sensors</span><strong>312</strong></li>
              <li><span>Public Wi‑Fi hotspots</span><strong>154</strong></li>
            </ul>
            <div class="bar-chart">
              <div class="bar-row">
                <span class="bar-label">Power</span>
                <div class="bar-track"><div class="bar-fill" data-key="power"></div></div>
                <span class="bar-val" id="barPowerVal">0%</span>
              </div>
              <div class="bar-row">
                <span class="bar-label">Water</span>
                <div class="bar-track"><div class="bar-fill" data-key="water"></div></div>
                <span class="bar-val" id="barWaterVal">0%</span>
              </div>
              <div class="bar-row">
                <span class="bar-label">Waste</span>
                <div class="bar-track"><div class="bar-fill" data-key="waste"></div></div>
                <span class="bar-val" id="barWasteVal">0%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-2" style="margin-top:1rem;">
          <div class="panel tilt-card">
            <h2>Weather</h2>
            <p><span id="weatherTemp">28°C</span>, <span id="weatherDesc">Clear sky</span></p>
            <p>Humidity: <span id="weatherHumidity">60%</span></p>
          </div>
        </div>
      </section>

      <section id="services" class="page">
        <h1>Citizen Services</h1>
        <p class="subtitle">Apply for municipal services and track your requests.</p>

        <div class="grid-3">
          <div class="panel service-card tilt-card">
            <h3>New Water Connection</h3>
            <p>Apply for a new or upgraded water supply connection.</p>
            <button class="btn secondary service-apply" data-service="Water Connection">Apply</button>
          </div>
          <div class="panel service-card tilt-card">
            <h3>Electricity Connection</h3>
            <p>Submit request for domestic or commercial connection.</p>
            <button class="btn secondary service-apply" data-service="Electricity Connection">Apply</button>
          </div>
          <div class="panel service-card tilt-card">
            <h3>Property Tax</h3>
            <p>View outstanding dues and pay property tax online.</p>
            <button class="btn secondary service-apply" data-service="Property Tax">Pay Now</button>
          </div>
          <div class="panel service-card tilt-card">
            <h3>Birth / Death Certificate</h3>
            <p>Apply for new certificates or download copies.</p>
            <button class="btn secondary service-apply" data-service="Certificates">Apply</button>
          </div>
          <div class="panel service-card tilt-card">
            <h3>Building Permit</h3>
            <p>Submit building plan for approval and track status.</p>
            <button class="btn secondary service-apply" data-service="Building Permit">Submit</button>
          </div>
          <div class="panel service-card tilt-card">
            <h3>Solid Waste Pickup</h3>
            <p>Schedule bulk waste or e‑waste collection.</p>
            <button class="btn secondary service-apply" data-service="Waste Pickup">Schedule</button>
          </div>
        </div>

        <div style="margin-top:1.4rem;" class="panel tilt-card">
          <div class="chip"><span class="chip-dot"></span> My requests</div>
          <h2>Service Requests Timeline</h2>
          <table class="table">
            <thead><tr><th>Ref ID</th><th>Service</th><th>Date</th><th>Status</th></tr></thead>
            <tbody id="serviceTableBody"></tbody>
          </table>
        </div>

        <div id="serviceModal" class="modal">
          <div class="modal-content tilt-card">
            <span id="serviceClose" class="modal-close">&times;</span>
            <h2 id="serviceTitle">Apply for Service</h2>
            <form id="serviceForm" class="form">
              <label>Full Name<input type="text" id="svcName" required></label>
              <label>Email<input type="email" id="svcEmail" required></label>
              <label>Address<textarea id="svcAddress" rows="3" required></textarea></label>
              <label>Additional Details<textarea id="svcDetails" rows="3"></textarea></label>
              <button type="submit" class="btn primary">Submit Request</button>
            </form>
            <p id="serviceSuccess" class="success-msg hidden">
              Your request has been submitted. Reference ID: <span id="svcRef"></span>
            </p>
          </div>
        </div>
      </section>

      <section id="transport" class="page">
        <h1>Smart Transport</h1>
        <p class="subtitle">Live bus information and parking availability.</p>

        <div class="grid-2">
          <div class="panel tilt-card">
            <div class="chip"><span class="chip-dot"></span> Bus network</div>
            <h2>Live Bus Status</h2>
            <form id="busSearchForm" class="form inline">
              <label>From<input type="text" id="busFrom" placeholder="e.g. Central Station"></label>
              <label>To<input type="text" id="busTo" placeholder="e.g. Airport"></label>
              <button type="submit" class="btn primary small">Search</button>
              <button type="button" id="busReset" class="btn small ghost">Reset</button>
            </form>
            <table class="table" style="margin-top:0.5rem;">
              <thead><tr><th>Route</th><th>From</th><th>To</th><th>Next Bus</th><th>Status</th></tr></thead>
              <tbody id="busTableBody"></tbody>
            </table>
          </div>
          <div class="panel tilt-card">
            <div class="chip"><span class="chip-dot"></span> Parking</div>
            <h2>Parking Availability</h2>
            <ul id="parkingList" class="list"></ul>
          </div>
        </div>
      </section>

      <section id="complaints" class="page">
        <h1>Complaints & Issues</h1>
        <p class="subtitle">Raise civic complaints with tracking IDs.</p>

        <div class="panel tilt-card">
          <h2>Register Complaint</h2>
          <form id="complaintForm" class="form">
            <div class="grid-2">
              <label>Name<input type="text" id="cmpName" required></label>
              <label>Contact Number<input type="tel" id="cmpPhone" required></label>
            </div>
            <div class="grid-2">
              <label>
                Category
                <select id="cmpCategory" required>
                  <option value="">Select</option>
                  <option>Streetlight</option>
                  <option>Water Supply</option>
                  <option>Garbage</option>
                  <option>Road / Potholes</option>
                  <option>Traffic Signal</option>
                  <option>Other</option>
                </select>
              </label>
              <label>Location<input type="text" id="cmpLocation" required></label>
            </div>
            <label>Description<textarea id="cmpDescription" rows="4" required></textarea></label>
            <button type="submit" class="btn primary">Submit Complaint</button>
          </form>
        </div>

        <div style="margin-top:1.3rem;" class="panel tilt-card">
          <div class="chip"><span class="chip-dot"></span> History</div>
          <h2>My Complaints</h2>
          <table class="table">
            <thead><tr><th>ID</th><th>Category</th><th>Location</th><th>Status</th></tr></thead>
            <tbody id="complaintsTable"></tbody>
          </table>
        </div>
      </section>

      <section id="profile" class="page">
        <h1>My Profile</h1>
        <p class="subtitle">Profile data is stored in your browser using localStorage.</p>
        <div class="panel tilt-card">
          <h2>Citizen Details</h2>
          <form id="profileForm" class="form">
            <div class="grid-2">
              <label>Full Name<input type="text" id="prName"></label>
              <label>Email<input type="email" id="prEmail"></label>
            </div>
            <div class="grid-2">
              <label>Ward / Area<input type="text" id="prArea"></label>
              <label>Preferred Language<input type="text" id="prLang"></label>
            </div>
            <label>Address<textarea id="prAddress" rows="3"></textarea></label>
            <button type="submit" class="btn primary">Save Profile</button>
          </form>
        </div>
      </section>

      <section id="about" class="page">
        <h1>About the Portal</h1>
        <p class="subtitle">
          A single-page, interactive smart city portal with city-specific dashboard and micro-interactions.
        </p>
        <div class="panel tilt-card">
          <h2>Highlights</h2>
          <ul class="list">
            <li>
              <span>City selection on each load with dynamic dashboard text.</span>
              <span class="status-pill status-submitted">City‑aware</span>
            </li>
            <li>
              <span>Interactive cards with tilt, animated stats, and button ripples.</span>
              <span class="status-pill status-submitted">Micro‑UX</span>
            </li>
            <li>
              <span>Local persistence for users, services, and complaints.</span>
              <span class="status-pill status-submitted">localStorage</span>
            </li>
          </ul>
        </div>
      </section>
    </section>

    <section class="bottom-bar">
      <div class="panel tilt-card">
        <h2>Contact</h2>
        <p>24x7 City Helpline: <strong>1800-123-456</strong></p>
        <p>Email: support@smartcity.gov</p>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>&copy; 2025 Smart City Portal. All rights reserved.</p>
  </footer>

  <div id="authModal" class="modal">
    <div class="modal-content tilt-card">
      <span id="authClose" class="modal-close">&times;</span>
      <h2 id="authTitle">Login</h2>
      <div class="auth-tabs">
        <button id="tabLogin" class="btn small primary">Login</button>
        <button id="tabRegister" class="btn small ghost">Register</button>
      </div>
      <form id="loginForm" class="form">
        <label>Email<input type="email" id="loginEmail" required></label>
        <label>Password<input type="password" id="loginPassword" required></label>
        <button type="submit" class="btn primary">Login</button>
      </form>
      <form id="registerForm" class="form hidden">
        <label>Full Name<input type="text" id="regName" required></label>
        <label>Email<input type="email" id="regEmail" required></label>
        <label>Password<input type="password" id="regPassword" required></label>
        <button type="submit" class="btn primary">Register</button>
      </form>
      <p id="authMessage" class="success-msg hidden"></p>
    </div>
  </div>

  <div id="confetti" class="confetti-container"></div>

  <script>
    function $(s){return document.querySelector(s);}
    function $all(s){return document.querySelectorAll(s);}
    function save(k,v){localStorage.setItem(k,JSON.stringify(v));}
    function load(k,d){const v=localStorage.getItem(k);return v?JSON.parse(v):d;}

    function updateDateTime(){ $("#dateTime").textContent=new Date().toLocaleString(); }
    setInterval(updateDateTime,1000);updateDateTime();

    const themeToggle=$("#themeToggle");
    if(load("theme","dark")==="light"){document.body.classList.add("light");themeToggle.textContent="Dark";}
    themeToggle.addEventListener("click",()=>{
      document.body.classList.toggle("light");
      const isLight=document.body.classList.contains("light");
      themeToggle.textContent=isLight?"Dark":"Light";
      save("theme",isLight?"light":"dark");
    });

    const navItems=$all(".nav-item");
    const pages=$all(".page");
    function showPage(id){
      pages.forEach(p=>{
        const visible=p.id===id;
        const wasVisible=p.classList.contains("visible");
        p.classList.toggle("visible",visible);
        if(visible && !wasVisible){
          p.classList.remove("animate-in");
          void p.offsetWidth;
          p.classList.add("animate-in");
          setTimeout(()=>p.classList.remove("animate-in"),350);
        }
      });
      navItems.forEach(i=>i.classList.toggle("active",i.getAttribute("data-target")===id));
    }
    navItems.forEach(item=>item.addEventListener("click",()=>showPage(item.getAttribute("data-target"))));

    $all(".btn").forEach(btn=>{
      btn.addEventListener("click",e=>{
        const rect=btn.getBoundingClientRect();
        const x=e.clientX-rect.left;
        const y=e.clientY-rect.top;
        btn.style.setProperty("--ripple-x",x+"px");
        btn.style.setProperty("--ripple-y",y+"px");
        btn.classList.add("rippling");
        setTimeout(()=>btn.classList.remove("rippling"),250);
      });
    });

    $all(".tilt-card").forEach(card=>{
      card.addEventListener("mousemove",e=>{
        const rect=card.getBoundingClientRect();
        const x=e.clientX-rect.left;
        const y=e.clientY-rect.top;
        const rotateX=((y-rect.height/2)/rect.height)*8;
        const rotateY=((x-rect.width/2)/rect.width)*-8;
        card.style.transform=`rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-2px)`;
      });
      card.addEventListener("mouseleave",()=>{card.style.transform="rotateX(0deg) rotateY(0deg) translateY(0)";});
    });

    let currentUser=load("currentUser",null);
    let users=load("users",[]);
    const loginBtn=$("#loginBtn");
    const logoutBtn=$("#logoutBtn");
    const welcomeUser=$("#welcomeUser");
    const authModal=$("#authModal");
    const authClose=$("#authClose");
    const tabLogin=$("#tabLogin");
    const tabRegister=$("#tabRegister");
    const loginForm=$("#loginForm");
    const registerForm=$("#registerForm");
    const authTitle=$("#authTitle");
    const authMessage=$("#authMessage");

    function updateAuthUI(){
      if(currentUser){
        welcomeUser.textContent="Hello, "+currentUser.name;
        loginBtn.classList.add("hidden");
        logoutBtn.classList.remove("hidden");
      }else{
        welcomeUser.textContent="";
        loginBtn.classList.remove("hidden");
        logoutBtn.classList.add("hidden");
      }
    }
    updateAuthUI();

    loginBtn.addEventListener("click",()=>authModal.classList.add("show"));
    logoutBtn.addEventListener("click",()=>{currentUser=null;save("currentUser",null);updateAuthUI();alert("You have been logged out.");});
    authClose.addEventListener("click",()=>authModal.classList.remove("show"));
    authModal.addEventListener("click",e=>{if(e.target===authModal)authModal.classList.remove("show");});
    function switchToLogin(){authTitle.textContent="Login";loginForm.classList.remove("hidden");registerForm.classList.add("hidden");tabLogin.classList.remove("ghost");tabRegister.classList.add("ghost");}
    function switchToRegister(){authTitle.textContent="Register";loginForm.classList.add("hidden");registerForm.classList.remove("hidden");tabRegister.classList.remove("ghost");tabLogin.classList.add("ghost");}
    tabLogin.addEventListener("click",switchToLogin);
    tabRegister.addEventListener("click",switchToRegister);

    loginForm.addEventListener("submit",e=>{
      e.preventDefault();
      const email=$("#loginEmail").value.trim();
      const pass=$("#loginPassword").value.trim();
      const user=users.find(u=>u.email===email&&u.password===pass);
      if(!user){authMessage.textContent="Invalid email or password.";authMessage.classList.remove("hidden");authMessage.style.color="var(--danger)";return;}
      currentUser={name:user.name,email:user.email};
      save("currentUser",currentUser);
      updateAuthUI();
      authMessage.textContent="Login successful.";authMessage.style.color="#16a34a";authMessage.classList.remove("hidden");
      setTimeout(()=>authModal.classList.remove("show"),900);
    });

    registerForm.addEventListener("submit",e=>{
      e.preventDefault();
      const name=$("#regName").value.trim();
      const email=$("#regEmail").value.trim();
      const pass=$("#regPassword").value.trim();
      if(users.some(u=>u.email===email)){authMessage.textContent="Email already registered.";authMessage.style.color="var(--danger)";authMessage.classList.remove("hidden");return;}
      const newUser={name,email,password:pass};
      users.push(newUser);save("users",users);
      authMessage.textContent="Registered successfully. You can login now.";authMessage.style.color="#16a34a";authMessage.classList.remove("hidden");
      switchToLogin();
    });

    const alerts=[
      "Minor congestion at Science City Park, average speed 18 km/h.",
      "Air quality moderate in Central Zone, AQI 92.",
      "Smart parking free slots at PVP Square Mall Road: 64.",
      "Garbage pickup completed in Sector 21 and 22.",
      "Scheduled maintenance of water supply tomorrow 10:00–13:00 in Ward 12."
    ];
    const alertsList=$("#alertsList");
    alerts.forEach(text=>{
      const li=document.createElement("li");
      const span=document.createElement("span");
      span.textContent=text;
      const pill=document.createElement("span");
      pill.className="status-pill status-submitted";
      pill.textContent="Live";
      li.appendChild(span);li.appendChild(pill);
      alertsList.appendChild(li);
    });

    function countUp(el,target,duration=700){
      const start=Number(el.textContent)||0;
      const startTime=performance.now();
      function tick(now){
        const progress=Math.min((now-startTime)/duration,1);
        const value=Math.floor(start+(target-start)*progress);
        el.textContent=value;
        if(progress<1)requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function randomAround(base,spread){return base+((Math.random()*spread*2)-spread);}

    function refreshDashboard(first=false){
      const aqi=Math.round(randomAround(60,12));
      const aqiEl=$("#aqiValue");
      if(first)aqiEl.textContent=aqi;else countUp(aqiEl,aqi);
      const aqiTag=$("#aqiTag");const aqiTrend=$("#aqiTrend");
      if(aqi<=50){aqiTag.textContent="Good";aqiTag.className="tag good";aqiTrend.textContent="Air quality is healthy today.";}
      else if(aqi<=100){aqiTag.textContent="Moderate";aqiTag.className="tag warning";aqiTrend.textContent="Sensitive groups should limit outdoor time.";}
      else{aqiTag.textContent="Poor";aqiTag.className="tag danger";aqiTrend.textContent="Reduce outdoor activity where possible.";}

      const energyVal=randomAround(130,10);
      $("#energyValue").textContent=energyVal.toFixed(1);
      $("#energyTrend").textContent=energyVal>135?"Above daily average":"Within normal range";

      const waterVal=Math.round(randomAround(75,5));
      const waterEl=$("#waterValue");
      if(first)waterEl.textContent=waterVal;else countUp(waterEl,waterVal);
      $("#waterTrend").textContent=waterVal<70?"Slightly low, monitoring":"Stable supply";

      const states=["Low","Moderate","High"];
      const txts={Low:"Smooth movement in most corridors.",Moderate:"Usual peak-hour slowdowns.",High:"Expect delays on major routes."};
      const tState=states[Math.floor(Math.random()*states.length)];
      $("#trafficValue").textContent=tState;
      $("#trafficTrend").textContent=txts[tState];

      const powerPct=Math.min(100,Math.max(0,Math.round(energyVal/2)));
      const waterPct=Math.min(100,Math.max(0,waterVal));
      const wastePct=60+Math.round(Math.random()*20);
      document.querySelector('.bar-fill[data-key="power"]').style.width=powerPct+"%";
      document.querySelector('.bar-fill[data-key="water"]').style.width=waterPct+"%";
      document.querySelector('.bar-fill[data-key="waste"]').style.width=wastePct+"%";
      $("#barPowerVal").textContent=powerPct+"%";
      $("#barWaterVal").textContent=waterPct+"%";
      $("#barWasteVal").textContent=wastePct+"%";
    }
    refreshDashboard(true);
    setInterval(()=>refreshDashboard(false),8000);

    function updateWeather(){
      const temps=[27,28,29,30];
      const descs=["Clear sky","Partly cloudy","Light rain","Haze"];
      const hums=[55,60,65,70];
      const i=Math.floor(Math.random()*temps.length);
      $("#weatherTemp").textContent=temps[i]+"°C";
      $("#weatherDesc").textContent=descs[i];
      $("#weatherHumidity").textContent=hums[i]+"%";
    }
    updateWeather();
    setInterval(updateWeather,15000);

    const confettiContainer=$("#confetti");
    function launchConfetti(){
      for(let i=0;i<40;i++){
        const piece=document.createElement("div");
        piece.className="confetti-piece";
        piece.style.left=Math.random()*100+"vw";
        piece.style.background=["#38bdf8","#22c55e","#f97316","#e5e7eb"][i%4];
        piece.style.setProperty("--dx",(Math.random()*120-60)+"px");
        confettiContainer.appendChild(piece);
        setTimeout(()=>piece.remove(),1500);
      }
    }

    let serviceRequests=load("serviceRequests",[]);
    const serviceButtons=$all(".service-apply");
    const serviceModal=$("#serviceModal");
    const serviceTitle=$("#serviceTitle");
    const serviceClose=$("#serviceClose");
    const serviceForm=$("#serviceForm");
    const serviceSuccess=$("#serviceSuccess");
    const svcRef=$("#svcRef");
    const serviceTableBody=$("#serviceTableBody");

    function renderServices(){
      serviceTableBody.innerHTML="";
      serviceRequests.forEach(req=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${req.id}</td>
          <td>${req.service}</td>
          <td>${req.date}</td>
          <td><span class="status-pill status-submitted">${req.status}</span></td>
        `;
        serviceTableBody.appendChild(tr);
      });
    }
    renderServices();

    let currentServiceName="";
    serviceButtons.forEach(btn=>{
      btn.addEventListener("click",()=>{
        currentServiceName=btn.getAttribute("data-service");
        serviceTitle.textContent="Request: "+currentServiceName;
        serviceModal.classList.add("show");
        serviceSuccess.classList.add("hidden");
        serviceForm.reset();
      });
    });
    serviceClose.addEventListener("click",()=>serviceModal.classList.remove("show"));
    serviceModal.addEventListener("click",e=>{if(e.target===serviceModal)serviceModal.classList.remove("show");});

    serviceForm.addEventListener("submit",e=>{
      e.preventDefault();
      const ref="SVC-"+Math.floor(Math.random()*900000+100000);
      svcRef.textContent=ref;
      serviceSuccess.classList.remove("hidden");
      const today=new Date().toLocaleDateString();
      const newReq={id:ref,service:currentServiceName||"Service",date:today,status:"Submitted"};
      serviceRequests.unshift(newReq);save("serviceRequests",serviceRequests);renderServices();
      launchConfetti();
    });

    const busData=[
      {route:"B12",from:"RTC Bus Stand",to:"Millenium Park",next:"5 min",status:"On Time"},
      {route:"C07",from:"PVP Square Mall",to:"Airport",next:"12 min",status:"Delayed"},
      {route:"R21",from:"KL University",to:"Trend Set Mall",next:"2 min",status:"Arriving"},
      {route:"G03",from:"Green City Park",to:"Railway Station",next:"18 min",status:"On Time"},
      {route:"M15",from:"RMD Square",to:"Maidan",next:"9 min",status:"On Time"}
    ];
    const busTableBody=$("#busTableBody");
    function renderBuses(list){
      busTableBody.innerHTML="";
      list.forEach(bus=>{
        const statusClass=bus.status==="Delayed"?"status-open":"status-submitted";
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${bus.route}</td>
          <td>${bus.from}</td>
          <td>${bus.to}</td>
          <td>${bus.next}</td>
          <td><span class="status-pill ${statusClass}">${bus.status}</span></td>
        `;
        busTableBody.appendChild(tr);
      });
    }
    renderBuses(busData);

    const busSearchForm=$("#busSearchForm");
    const busFrom=$("#busFrom");
    const busTo=$("#busTo");
    const busReset=$("#busReset");
    busSearchForm.addEventListener("submit",e=>{
      e.preventDefault();
      const fromVal=busFrom.value.trim().toLowerCase();
      const toVal=busTo.value.trim().toLowerCase();
      const filtered=busData.filter(b=>{
        const okFrom=fromVal?b.from.toLowerCase().includes(fromVal):true;
        const okTo=toVal?b.to.toLowerCase().includes(toVal):true;
        return okFrom&&okTo;
      });
      renderBuses(filtered);
    });
    busReset.addEventListener("click",()=>{busFrom.value="";busTo.value="";renderBuses(busData);});

    const parkingData=[
      {name:"PVP Square Mall Parking",free:42,total:120},
      {name:"Mani Square Basement",free:15,total:80},
      {name:"Rajiv Gandhi Stadium Parking",free:87,total:200},
      {name:"Bapu Museum Lot",free:6,total:40}
    ];
    const parkingList=$("#parkingList");
    function renderParking(){
      parkingList.innerHTML="";
      parkingData.forEach(p=>{
        const li=document.createElement("li");
        const percent=Math.round(p.free/p.total*100);
        const span=document.createElement("span");
        span.textContent=`${p.name} – Free: ${p.free}/${p.total}`;
        const pill=document.createElement("span");
        pill.className="status-pill "+(percent<20?"status-open":"status-submitted");
        pill.textContent=percent+"%";
        li.appendChild(span);li.appendChild(pill);
        parkingList.appendChild(li);
      });
    }
    renderParking();

    let complaints=load("complaints",[]);
    const complaintForm=$("#complaintForm");
    const complaintsTable=$("#complaintsTable");
    function renderComplaints(){
      complaintsTable.innerHTML="";
      complaints.forEach(c=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${c.id}</td>
          <td>${c.category}</td>
          <td>${c.location}</td>
          <td><span class="status-pill status-open">${c.status}</span></td>
        `;
        complaintsTable.appendChild(tr);
      });
    }
    renderComplaints();
    let complaintCounter=complaints.length?complaints.length+1:1;
    complaintForm.addEventListener("submit",e=>{
      e.preventDefault();
      const category=$("#cmpCategory").value;
      const location=$("#cmpLocation").value;
      const id="CMP-"+complaintCounter.toString().padStart(4,"0");
      complaintCounter++;
      const newC={id,category,location,status:"Open"};
      complaints.unshift(newC);save("complaints",complaints);renderComplaints();
      complaintForm.reset();
      alert("Complaint submitted. Reference ID: "+id);
      launchConfetti();
    });

    const profileForm=$("#profileForm");
    const prName=$("#prName");
    const prEmail=$("#prEmail");
    const prArea=$("#prArea");
    const prLang=$("#prLang");
    const prAddress=$("#prAddress");
    let profile=load("profile",{name:"",email:"",area:"",lang:"",address:""});
    function renderProfile(){
      prName.value=profile.name||(currentUser?currentUser.name:"");
      prEmail.value=profile.email||(currentUser?currentUser.email:"");
      prArea.value=profile.area||"";
      prLang.value=profile.lang||"";
      prAddress.value=profile.address||"";
    }
    renderProfile();
    profileForm.addEventListener("submit",e=>{
      e.preventDefault();
      profile={
        name:prName.value.trim(),
        email:prEmail.value.trim(),
        area:prArea.value.trim(),
        lang:prLang.value.trim(),
        address:prAddress.value.trim()
      };
      save("profile",profile);
      alert("Profile updated successfully.");
      if(currentUser){
        currentUser.name=profile.name||currentUser.name;
        currentUser.email=profile.email||currentUser.email;
        save("currentUser",currentUser);
        updateAuthUI();
      }
      launchConfetti();
    });

    const cityOverlay=$("#cityOverlay");
    const citySelect=$("#citySelect");
    const cityChips=$all(".city-chip");
    const cityConfirmBtn=$("#cityConfirmBtn");
    const cityResetBtn=$("#cityResetBtn");
    const selectedCityLabel=$("#selectedCityLabel");
    const cityNameBadge=$("#cityNameBadge");
    const dashTitle=$("#dashTitle");
    const dashSubtitle=$("#dashSubtitle");

    function applyCity(city){
      if(!city){
        cityNameBadge.textContent="PORTAL";
        dashTitle.textContent="City Operations";
        dashSubtitle.textContent="Live snapshot of environment, mobility, and utilities.";
        return;
      }
      cityNameBadge.textContent=city;
      dashTitle.textContent=city+" Smart City Operations";
      dashSubtitle.textContent="Live snapshot of "+city+" environment, mobility, and utilities.";
    }

    function updateSelectedCityLabel(){
      const city=citySelect.value;
      if(city){
        selectedCityLabel.textContent="Selected: "+city;
        selectedCityLabel.classList.remove("hidden");
      }else{
        selectedCityLabel.classList.add("hidden");
      }
    }
    citySelect.addEventListener("change",updateSelectedCityLabel);
    cityChips.forEach(chip=>{
      chip.addEventListener("click",()=>{
        const city=chip.getAttribute("data-city");
        citySelect.value=city;
        updateSelectedCityLabel();
      });
    });

    cityConfirmBtn.addEventListener("click",()=>{
      const city=citySelect.value;
      if(!city){alert("Please select a city first.");return;}
      applyCity(city);
      cityOverlay.classList.add("hidden");
      launchConfetti();
    });

    cityResetBtn.addEventListener("click",()=>{
      citySelect.value="";
      updateSelectedCityLabel();
      cityOverlay.classList.remove("hidden");
      applyCity(null);
    });
  </script>
</body>
</html>
